////
////    privacyControl - JS
////    Author: Louis Mudrack
////    Version: 1.3
////    Date released: 08/14/2023
////
////////////////////

const cmToggle={elementName:"cookie-manager-toggler",className:"closed"},cmParent={elementName:"cookie-manager"},cmChilds=[{elementName:"cm-heading",textContent:"Manage Cookies"},{elementName:"cm-close",textContent:"X"},{elementName:"cm-essentials",childElements:[{elementName:"a",className:"reset",textContent:"zur\xfccksetzen"},{elementName:"a",className:"legal",textContent:"Impressum"},{elementName:"a",className:"privacy",textContent:"Datenschutz"},]},{elementName:"cm-body"},{elementName:"cm-footer",childElements:[{elementName:"cm-text",textContent:"Diese Website nutzt Cookies oder Drittanbieterdienste nur mit Ihrem Einverst\xe4ndnis - jederzeit wiederruflich und freiwillig!"},{elementName:"cm-buttons",textContent:"Alle akzeptieren"},]},];class PrivacyControl{constructor(e={}){this.deps=[],this.initUI(),this.setupEventListeners(),this.createCookies(e)}initUI(){this.createNodes(cmToggle,[],document.body),this.createNodes(cmParent,cmChilds,document.body),this.cookieManager=document.querySelector("cookie-manager"),this.cookieManagerToggler=document.querySelector("cookie-manager-toggler"),this.cmClose=document.querySelector("cm-close"),this.cmBody=document.querySelector("cm-body")}createNodes(e,t,n){let{elementName:c,className:a,textContent:r}=e,i=document.createElement(c);a&&i.classList.add(a),r&&(i.textContent=r),t.forEach(e=>{let{elementName:t,className:n,textContent:c,childElements:a}=e,r=document.createElement(t);n&&r.classList.add(n),c&&(r.textContent=c),a&&this.createNodes(e,a,r),i.appendChild(r)}),n.appendChild(i)}setupEventListeners(){this.cmClose.addEventListener("click",()=>this.close()),this.cookieManagerToggler.addEventListener("click",()=>this.toggle())}close(){this.cookieManagerToggler.classList.add("closed"),this.cookieManagerToggler.classList.remove("hide"),this.cookieManager.classList.remove("opened")}open(){this.cookieManager.classList.add("opened"),this.cookieManagerToggler.classList.add("hide"),this.cookieManagerToggler.classList.remove("closed")}toggle(){this.cookieManagerToggler.classList.contains("closed")?this.open():this.close()}createCookies(e){for(let t in e){if(e.hasOwnProperty(t)){let n={cookies:e[t]};this.deps.push(n)}for(let c in e[t]){let a=document.createElement("cm-category");this.cmBody.appendChild(a);let r=document.createElement("cm-row"),i=document.createElement("label");i.textContent="Akzeptieren:",i.setAttribute("for",`privacy-ctrl:${c}`);let o=document.createElement("input");o.setAttribute("type","checkbox"),o.setAttribute("id",`privacy-ctrl:${c}`),o.setAttribute("name",`${c}`),i.appendChild(o),r.appendChild(i),a.appendChild(r);let l=document.querySelector("cm-buttons");l.addEventListener("click",()=>{let e=document.querySelectorAll("input[type=checkbox]");e.forEach(e=>{e.checked=!0,e.dispatchEvent(new Event("change"))})});let s=document.createElement("cm-row"),d=document.createElement("p");d.textContent="Name:",s.appendChild(d);let m=document.createElement("p");m.textContent=e[t][c].name,s.appendChild(m),a.appendChild(s);let p=document.createElement("cm-row"),h=document.createElement("p");h.textContent="Anbieter:",p.appendChild(h);let g=document.createElement("p");g.textContent=e[t][c].provider,p.appendChild(g),a.appendChild(p);let u=document.createElement("cm-row"),k=document.createElement("p");k.textContent="Verwendungszweck:",u.appendChild(k);let C=document.createElement("p");C.textContent=e[t][c].lang,u.appendChild(C),a.appendChild(u);let b=document.createElement("cm-row"),y=document.createElement("p");y.textContent="Datenschutz:",b.appendChild(y),a.appendChild(b);let E=document.createElement("a");E.textContent="Link",E.setAttribute("href",e[t][c].privacy),E.setAttribute("title",e[t][c].privacy),E.setAttribute("target","_blank"),b.appendChild(E),a.appendChild(b);let L=document.querySelectorAll("cm-essentials a");L.forEach(e=>{e.classList.contains("reset")?e.addEventListener("click",()=>{let e=document.querySelectorAll("input[type=checkbox]");e.forEach(e=>{e.checked=!1,e.dispatchEvent(new Event("change"))})}):e.classList.contains("legal")?(e.setAttribute("href","/impressum"),e.setAttribute("title","Impressum")):e.classList.contains("privacy")&&(e.setAttribute("href","/datenschutzerklaerung"),e.setAttribute("title","Datenschutzerkl\xe4rung"))});let v=document.querySelectorAll(`iframe[data-cm-name="${c}"]`),A=document.getElementById(`privacy-ctrl:${c}`);A.dispatchEvent(new Event("change")),A.addEventListener("change",()=>{v.forEach(e=>{if(A.checked){e.setAttribute("data-cm-accept","true");let t=e.getAttribute("data-cm-src");e.setAttribute("src",t),document.cookie=`${c}=accepted; path=/`}else e.setAttribute("data-cm-accept","false"),e.setAttribute("src","cookie-manager.placeholder.html"),document.cookie=`${c}=denied; path=/`})}),v.forEach(n=>{!0===document.cookie.includes(`${c}=accepted`)?A.checked=!0:A.checked=!1,A.dispatchEvent(new Event("change")),"false"===n.getAttribute("data-cm-accept")&&(n.setAttribute("src","cookie-manager.placeholder.html"),n.addEventListener("load",()=>{if(n.src.startsWith(window.location.origin)){n.contentDocument.body.innerHTML=n.contentDocument.body.innerHTML.replace(/{{key}}/g,c),n.contentDocument.body.innerHTML=n.contentDocument.body.innerHTML.replace(/{{name}}/g,e[t][c].name),n.contentDocument.body.innerHTML=n.contentDocument.body.innerHTML.replace(/{{provider}}/g,e[t][c].provider),n.contentDocument.body.innerHTML=n.contentDocument.body.innerHTML.replace(/{{desc}}/g,e[t][c].lang),n.contentDocument.body.innerHTML=n.contentDocument.body.innerHTML.replace(/{{policy}}/g,e[t][c].privacy);n.contentDocument.querySelectorAll(`span[data-key="${c}"]`).forEach(e=>{e.addEventListener("click",()=>{let e=n.getAttribute("data-cm-src");n.setAttribute("src",e),document.cookie=`${c}=accepted; path=/`,A.checked=!0,A.dispatchEvent(new Event("change"))})})}}))})}}}}